<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1">
    <meta name="version" content="1">

    <title></title>

    <link integrity="" rel="stylesheet" href="css/base.css?v=2.2">
    <link rel="stylesheet" type="text/css" href="css/popup.css?v=2.1"/>
    <link rel="stylesheet" type="text/css" href="css/udid.css?v=2.1"/>
    <link rel="stylesheet" type="text/css" href="css/animate.min.css?v=2.1"/>
    <script type="text/javascript" src="js/mod.js?v=2.1"></script>

    <style type="text/css">
        .page_loading_background {
            cursor: wait;
            display: block;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, .5);
            position: absolute;
            top: 0;
            left: 0;
            z-index: 10001;
        }

        .page_loading_inner {
            color: #666;
            font-size: 16px;
            position: absolute;
            z-index: 10001;
            border: 1px solid rgb(187, 187, 187);
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            width: auto;
            height: 80px;
            line-height: 78px;
            padding-left: 16px;
            padding-right: 20px;
            background: #fff;
            cursor: pointer;
            border-radius: 8px;
            background-repeat: no-repeat;
            background-position: 8px 50%;
            box-shadow: 0 1px 15px rgba(0, 0, 0, .175);
        }

        .page_loading_inner i {
            font-size: 24px;
        }

        .invert_btn_txt {
            background: inherit;
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-align: center;
            filter: invert(1) grayscale(1) contrast(10);
        }
    </style>
    <script type="text/javascript">
    </script>
</head>
<body>
<div id="loading_background" class="page_loading_background" style="display: none;">
    <div class="page_loading_inner">
        <i class="fa fa-spinner fa-spin animated"></i> 正在加载中…
    </div>
</div>
<script type="text/javascript">
    rsid = 0;
    document.onreadystatechange = documentReadyState;

    function documentReadyState() {
        if (document.readyState === "complete") {
            completed();
            window.clearInterval(rsid);
        } else {
            document.getElementById('loading_background').style = '';
        }
    }

    function completed() {
        document.getElementById('loading_background').style = 'display: none;left: -10000px;';
        document.getElementById('loading_background').remove();
    }

    rsid = window.setInterval(documentReadyState, 1000);
</script>

<div style=" overflow:hidden; width:0px; height:0; margin:0 auto; position:absolute; top:-800px;"><img src=""></div>
<nav id="localnav" class="localnav" style="display: none;">
    <div class="localnav-background">
    </div>
    <div class="localnav-content"><h2 class="localnav-title localnav-content-h2">App Store 预览</h2></div>
</nav>
<div>
    <section class="l-content-width section section--hero">
        <div style="display: inline-block;width: 32vw;vertical-align: top;">
            <div id="appdetails-icon" class="appdetails-icon small-5" style="width: 100%;">
                <div class="ios-app-icon">
                    <img class="ios-app-icon-img" id="#app_icon#" src="" style="background-color: #fefefe;" alt>
                </div>
            </div>
        </div>
        <div style="display: inline-block;width: 52vw;vertical-align: top;margin-left: 8px;">
            <div>
                <div class="ios-app-brief">
                    <header class="ios-app-brief-header">
                        <h1 class="ios-app-title"
                            style="font-size: 20px;height: 1.2223em;width: 50vw;overflow: hidden;text-overflow: ellipsis;white-space: nowrap;">
                            <span id="#app_name#"></span> <span class="ios-app-title-cls" style="display: none;">18+</span>
                        </h1>
                        <h2 class="ios-app-subtitle" style="font-size: 14px;"><span id="#app_desc#"></span></h2>
                        <h2 class="ios-app-vendor" style="font-size: 14px;"><a href="javascript:;"><span id=#app_owner#></span></a></h2>
                    </header>
                </div>
            </div>
            <div>
                <div style="position: absolute;">
                    <ul class="ios-app-recom" style="width:100%">
                        <li id="install_btn_container" class="install-btn-container " style="display: inline-block;">
                            <div style="width: 20px;height: 20px;padding: 4px;border-width: 1px;">Loading</div>
                            <div style="width: 88px;" id="installUDID">
                                <a data-ios-down-new="1" auto-open="1" s1="xxx" id="ios-download" href="javascript:;" style="color: #FFF;"
                                   onclick="require('components/udid/udid').installUDID()">免费安装</a>
                            </div>
                            <div data-ios-installing="1" auto-open="0" id="ios-installing" style="border-color: darkgray;display: none">
                                <div class="invert_btn_txt">安装</div>
                            </div>
                            <div id="step2">正在授权应用 <span id="install_tips_progress">0%</span> <span style="color: #0070c9;">请等待授权完成</span>
                            </div>
                        </li>
                        <a id="trylink" href="#app_scheme#" style="width: 0px;display: none;"></a>
                        <!-- <li id="showhelp" class="ios-app-install-btn" style="width: 28px;position: relative;float: right;top: 0px;right: 10px;display: none;" onclick="document.all['pagemask'].style.display='block';document.body.style.height='100%';document.body.style.overflow='hidden';this.style.backgroundColor='darkgray';this.style.borderColor='darkgray';$('#moremenu').addClass('showmore_anim');">?</li> -->
                    </ul>
                </div>
                <div id="showhelp" class="ios-app-install-btn" style="width: 28px;position: relative;float: right;right: 10px;"
                     onclick="require('components/udid/udid').hasGuideInstall()">?
                    <div id="reload_dl" style="
                                display: none;
                                position: absolute;
                                float: right;
                                right: 0px;
                                color: rgb(255, 255, 255);
                                background-color: rgb(1, 122, 254);
                                border-color: rgb(112, 166, 231);
                                border-radius: 30px;
                                width: 28px;
                                padding-top: 4px;
                                padding-bottom: 2px;
                                padding-right: 2px;
                                display: none;
                                text-align: center;
                                vertical-align: middle;
                                height: 24px;
                                border-width: 1px;
                                border-style: solid;
                            ">
                        <svg style="
                                filter: invert(1) grayscale(1) contrast(1);
                            " viewBox="0 0 24 24" height="20" width="20" xmlns="http://www.w3.org/2000/svg">&gt;<path
                                d="M13.5 2c-5.288 0-9.649 3.914-10.377 9h-3.123l4 5.917 4-5.917h-2.847c.711-3.972 4.174-7 8.347-7 4.687 0 8.5 3.813 8.5 8.5s-3.813 8.5-8.5 8.5c-3.015 0-5.662-1.583-7.171-3.957l-1.2 1.775c1.916 2.536 4.948 4.182 8.371 4.182 5.797 0 10.5-4.702 10.5-10.5s-4.703-10.5-10.5-10.5z"></path>
                        </svg>
                    </div>
                    <div id="dlinfos" style="position: relative;top: 34px;font-size: 12px;color: darkgray;"></div>
                </div>
            </div>
    </section>
    <section class="l-content-width">
        <div class="ios-app-rating" style="width:45%">
            <figure class="ios-app-rating">
                <figcaption class="ios-app-rating-caption-big">4.9</figcaption>
                <span class="ios-app-rating-star-outline-big vertical_mid">
                            <span class="ios-app-rating-stars-big ios-app-rating-stars-big-5"></span>
                        </span>
            </figure>
            <h5 class="ios-caption-subtitle">14.4K 个评分</h5>
        </div>
        <div class="ios-app-rating" style="width:25%; text-align: center;">
            <div class="ios-app-rating-caption-big"><font style="vertical-align: super;font-size: 12px">#</font>8</div>
            <h5 class="ios-caption-subtitle">社交工具</h5>
        </div>
        <div class="ios-app-rating" style="width:25%; text-align: right;">
            <div class="ios-app-rating-caption-big">18+</div>
            <h5 class="ios-caption-subtitle">年龄</h5>
        </div>
    </section>
    <section class="l-content-width section">
        <!-- <h2 class="section__headline">iPhone 屏幕快照</h2> -->
        <ul class="ios-app-screenshot-viewer">
        </ul>
    </section>
    <section class="l-content-width section section--bordered">
        <h2 class="section__headline">简介</h2>
        <div class="ellipsis">
            <div class="ellipsis-container">
                <div class="ellipsis-content">
                    火爆视频交友
                </div>
                <div class="ellipsis-ghost">
                    <div class="ellipsis-placeholder"></div>
                    <div class="ellipsis-more" style="background-image: linear-gradient(to right , #ffffff00, #ffffffff 40%);">更多</div>
                </div>
            </div>
        </div>
    </section>
    <section class="l-content-width section section--bordered">
        <h2 class="section__headline">评分及评论</h2>
        <div class="ios-app-cust-ratings">
            <div class="ios-app-cust-ratings_stats">
                <h3 class="ios-app-ratings_avg">
                    <span class="ios-app-ratings_avg_disp">4.9</span>
                    满分 5 分
                </h3>
            </div>
            <div class="ios-app-ratings-bars">
                <figure>
                    <div class="ios-app-ratings-bar-row">
                        <span class="ios-app-rating-stargraph__stars ios-app-rating-stargraph__stars-5"></span>
                        <div class="ios-app-rating-bargraph__bar">
                            <div class="ios-app-rating-bargraph__bar-foreground" style="width: 91.5676%;"></div>
                        </div>
                    </div>
                    <div class="ios-app-ratings-bar-row">
                        <span class="ios-app-rating-stargraph__stars ios-app-rating-stargraph__stars-4"></span>
                        <div class="ios-app-rating-bargraph__bar">
                            <div class="ios-app-rating-bargraph__bar-foreground" style="width: 7.6469%;"></div>
                        </div>
                    </div>
                    <div class="ios-app-ratings-bar-row">
                        <span class="ios-app-rating-stargraph__stars ios-app-rating-stargraph__stars-3"></span>
                        <div class="ios-app-rating-bargraph__bar">
                            <div class="ios-app-rating-bargraph__bar-foreground" style="width: 0.5005%;"></div>
                        </div>
                    </div>
                    <div class="ios-app-ratings-bar-row">
                        <span class="ios-app-rating-stargraph__stars ios-app-rating-stargraph__stars-2"></span>
                        <div class="ios-app-rating-bargraph__bar">
                            <div class="ios-app-rating-bargraph__bar-foreground" style="width: 0.2503%;"></div>
                        </div>
                    </div>
                    <div class="ios-app-ratings-bar-row">
                        <span class="ios-app-rating-stargraph__stars "></span>
                        <div class="ios-app-rating-bargraph__bar">
                            <div class="ios-app-rating-bargraph__bar-foreground" style="width: 0.0348%;"></div>
                        </div>
                    </div>
                </figure>
                <h5 class="ios-app-rating-count">14.4K 个评分</h5>
            </div>
        </div>
        <div class="ios-app-comments-list">
        </div>
    </section>
    <section class="l-content-width section section--bordered">
        <h2 class="section__headline">新功能</h2>
        <div class="ios-app-whatsnew-content ios-app-whatsnew-latest">
            <p class="">版本 </p>
        </div>
        <div class="ios-app-whatsnew-content">
            <span class="we-clamp__contents"></span>
        </div>
    </section>
    <section class="l-content-width section section--bordered">
        <h2 class="section__headline">信息</h2>
        <dl class="ios-app-infor-list">
            <div class="ios-app-infor-list_row row-bottom-border">
                <dt class="ios-app-infor-list_row_term">销售商</dt>
                <dd class="ios-app-infor-list_row_val"><span id="#app_owner#"></span></dd>
            </div>
            <div class="ios-app-infor-list_row row-bottom-border">
                <dt class="ios-app-infor-list_row_term">大小</dt>
                <dd class="ios-app-infor-list_row_val"> KB</dd>
            </div>
            <div class="ios-app-infor-list_row row-bottom-border">
                <dt class="ios-app-infor-list_row_term">类别</dt>
                <dd class="ios-app-infor-list_row_val"><a href="javascript:;">应用</a></dd>
            </div>
            <div class="ios-app-infor-list_row row-bottom-border">
                <dt class="ios-app-infor-list_row_term">兼容性</dt>
                <dd class="ios-app-infor-list_row_val">
                    <div class="we-clamp"><span>需要 iOS 8.0 或更高版本。与 iPhone、iPad 和 iPod touch 兼容。</span></div>
                </dd>
            </div>
            <div class="ios-app-infor-list_row row-bottom-border">
                <dt class="ios-app-infor-list_row_term">语言</dt>
                <dd class="ios-app-infor-list_row_val">
                    <div class="we-clamp"><span>英语,简体中文</span></div>
                </dd>
            </div>
            <div class="ios-app-infor-list_row row-bottom-border">
                <dt class="ios-app-infor-list_row_term">年龄分级</dt>
                <dd class="ios-app-infor-list_row_val">限18岁以上</dd>
            </div>
            <div class="ios-app-infor-list_row row-bottom-border">
                <dt class="ios-app-infor-list_row_term">Copyright</dt>
                <dd class="ios-app-infor-list_row_val"><span id="#app_owner#"></span></dd>
            </div>
            <div class="ios-app-infor-list_row row-bottom-border">
                <dt class="ios-app-infor-list_row_term">价格</dt>
                <dd class="ios-app-infor-list_row_val">免费</dd>
            </div>
            <div class="ios-app-infor-list_row">
                <dt class="ios-app-infor-list_row_term"><a href="javascript:;">隐私政策</a></dt>
                <dd class="ios-app-infor-list_row_val">✋</dd>
            </div>
        </dl>
    </section>
</div>

<!-- 弹窗 -->
<div class="m-xx-tap">
    <a data-android-down="1" class="down android"></a>
    <a data-ios-down="1" class="down ios"></a>
</div>
<script type="text/javascript" src="js/mod.js?v=2.1"></script>
<script type="text/javascript">/*resourcemap*/
require.resourceMap({
    "res": {
        "components/popup/popup": {
            "url": "js/app.js?v=2.1",
            "type": "js"
        },
        "components/udid/_guideInstall": {
            "url": "js/app.js?v=2.1",
            "type": "js",
            "deps": [
                "components/popup/popup"
            ]
        },
        "components/udid/_profileExplain": {
            "url": "js/app.js?v=2.1",
            "type": "js",
            "deps": [
                "components/popup/popup"
            ]
        },
        "components/udid/udid": {
            "url": "js/app.js?v=2.1",
            "type": "js",
            "deps": [
                "components/popup/popup",
                "components/udid/_guideInstall",
                "components/udid/_profileExplain"
            ]
        },
        "page/m/m": {
            "url": "js/app.js?v=2.1",
            "type": "js",
            "deps": [
                "components/udid/udid"
            ]
        }
    },
    "pkg": {}
});
</script>
<script type="text/javascript" src="js/globle.js?v=2.1"></script>
<script type="text/javascript" src="js/jquery.js?v=2.1"></script>
<script type="text/javascript" src="js/swipe.js?v=2.1"></script>
<script charset="utf-8" src="js/qrcode.js?v=2.1"></script>
<script>
    function getUrlParam(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)"); //构造一个含有目标参数的正则表达式对象
        var r = window.location.search.substr(1).match(reg);  //匹配目标参数
        if (r != null) return unescape(r[2]);
        return null; //返回参数值
    }

    var uuid = "";
    var download_id = "";
    var project = getUrlParam('project');
    var app = {};
    $(function () {
        $.ajax({
            url: "/apple/info",
            data: {
                project: project,
                udid: getUrlParam('udid') || "",
                uuid: getUrlParam('uuid') || "",
            },
            complete: function (rsp) {
                // 注入数据
                app = JSON.parse(rsp.responseText).result;
                $("[id=#app_name#]").text(app['name']);
                $("[id=#app_desc#]").text(app['desc']);
                $("[id=#app_owner#]").text(app['owner']);
                $("[id=#app_tip#]").text(app['tip'] || "新版本");
                $("[id=#app_rate#]").text(app['rate'] || "14.1K");
                $("[id=#app_rank#]").text(app['rank'] || "4.5");
                $("[id=#app_cate#]").text(app['cate'] || "游戏");
                $("[id=#app_icon#]").attr('src', app['icon']);
                $("[id=trylink]").attr('href', app['scheme']);
                uuid = app['uuid'];
                download_id = app["download_id"];
                // 判断是否注册
                if (app["ready"]) {
                    $("#ios-installing").show();
                    $("#ios-download").remove();
                    $("#ios-download").prop('click', null).off();
                    $("#reload_dl").show();
                    $("#showhelp").hide();
                    $("#installUDID").hide();
                    start_download();
                } else {
                    // 等待用户自己点击开始
                    $("#ios-download").attr('s1', uuid);
                    $("#step2").hide();
                }
            }
        });
    });

    require(['page/m/m']);
    if (G.platform.isSafari) {
        $(function () {
            window.setTimeout(function () {
                $('[auto-open=1]').click();
            }, 7 * 1000);
        });
    }
</script>
<script type="text/javascript">
    function _w4f(t) {
        $.getJSON("/apple/task_state?uuid=" + t, function (orig) {
            var data = orig.result;
            if (data.code === 0) {
                $('#install_tips_progress').text(data.progress);
                if (data.finished) {
                    // todo: 修正history
                    install_will_ok(t);
                } else {
                    window.setTimeout(_w4f, 3000, t);
                }
            } else if (data.code === 1) {
                // todo: 修正history
                window.location.reload();
            } else {
                $('#ios-installing div').text('下载失败');
                alert('下载应用失败，请重试！')
            }
        });
    }

    lastProgress = 0;
    lastBytes = 0;
    isDownloading = false;
    hasTracked = false;

    function _dlproc(s) {
        $.getJSON("/apple/download_process?uuid=" + s + "&download_id=" + download_id, function (orig) {
            var data = orig.result;
            if (data.code === 0) {
                // 停用下载按钮，改为重试按钮
                if (!isDownloading) {
                    isDownloading = true;
                    $('#ios-installing').prop('click', null).off();
                    $('#reload_dl').css('display', 'inline-block');
                    $('#reload_dl').click(function () {
                        if (confirm("确定重新下载吗？")) {
                            document.body.innerHTML += '<div id="loading_background" class="page_loading_background" style=""><div class="page_loading_inner"><i class="fa fa-spinner fa-spin animated"></i> 正在加载中…</div></div>';
                            window.location.reload();
                        }
                    });
                }

                if (data.progress === -1 || data.total > data.progress) {
                    var progress = (data.progress > 0) ? (10 + 90 * data.progress / data.total).toFixed(0) : Math.min(++lastProgress, 10);
                    $('#ios-installing').css('background', 'linear-gradient(90deg,#017AFE ' + progress + '%,lightgray ' + progress + '%)');
                    $('#ios-installing div').text('下载中 ' + progress + '%');
                    if (data.progress > 0) {
                        var speed = (data.progress - lastBytes);
                        var remains = '';
                        if (speed > 0) {
                            remains = Math.floor((data.total - data.progress) / speed);
                            if (remains > 60) remains = '约' + (Math.floor(remains / 60) + 1) + '分钟';
                            else remains = '约' + remains + '秒';
                        }
                        if (speed >= 1048576) speed = (speed / 1048576).toFixed(1) + 'MB/s';
                        else speed = (speed / 1024).toFixed(1) + 'KB/s';

                        $('#dlinfos').text(Math.floor(data.total / 1048576) + 'MB ' + speed + ' ' + remains);
                        lastBytes = data.progress;

                        if (!hasTracked) {
                            hasTracked = true;
                        }
                    }
                    window.setTimeout(_dlproc, 1000, s);
                } else {
                    $('#ios-installing').css('background', '#017AFE');
                    $('#ios-installing div').text('安装中……');
                    $('#dlinfos').text('');

                    function countdown(f, n) {
                        $('#ios-installing div').text('安装中……' + n + '秒');
                        if (n > 0)
                            window.setTimeout(f, 1000, f, n - 1);
                        else {
                            $('#ios-installing div').text('打开');
                            $('#ios-installing').click(function () {
                                // 尝试打开
                                $('#trylink').off();
                                $('#trylink').on('click', function () {
                                    // todo: 记录try_link操作
                                    window.setTimeout(function (tryTime) {
                                        thisTime = new Date().getTime();
                                        if (Math.abs(thisTime - tryTime - 5000) < 1000) {
                                            $('#ios-installing div').text('已安装，请在桌面打开');
                                            alert('已安装，请在桌面打开');
                                        }
                                    }, 5000, new Date().getTime());
                                });
                                $('#trylink').get()[0].click();
                            });
                        }
                    }

                    countdown(countdown, 20);
                }
            } else {
                window.setTimeout(_dlproc, 3000, s);
            }
        })
            .fail(function (xhr, status, error) {
                console.log(xhr, status, error);
                window.setTimeout(_dlproc, 3000, s);
            });
    }

    function install_will_ok() {
        $("#installUDID").remove();
        $('#step2').hide();
        // todo: 更新history
        var url = "https://" + window.location.host + "/apple/manifest?uuid=" + uuid + "&download_id=" + download_id;
        var manifest_url = "itms-services://?action=download-manifest&url=" + encodeURIComponent(url);
        $('#ios-installing').css('width', 'auto');
        $('#ios-installing div').css('font-size', '12px').css('width', '154px').text("准备安装");
        $('#install_btn_container').removeClass('install-btn-container-loading');
        $('#ios-installing').prop('click', null).off();
        $('#ios-installing').click(function () {
            if (!isDownloading) {
                window.location.href = manifest_url;
                $('#ios-installing div').text("等待下载");
                window.clearTimeout(_dlproc);
                window.setTimeout(_dlproc, 3000, uuid);
            } else {

            }
        });
        // window.location.href=manifest_url;
        $('#ios-installing').click();
    }

    function start_download() {
        $('#ios-installing').click(function () {
            $('#install_btn_container').addClass('install-btn-container-loading');
        });
        $('#ios-installing').click();
        _w4f(uuid);
    }
</script>
<div id="pagemask"
     style="background-color: rgba(0, 0, 0, 0.6);width: 100%;height: 100%;left: 0;top: 0;position: absolute;z-index: 9999;display: none;"
     onclick="this.style.display='none';document.body.style.height='';document.body.style.overflow='';$('#showmore').css('background-color','');$('#showmore').css('border-color','');$('#moremenu').removeClass('showmore_anim');">
    <div id="moremenu" style="position: relative;top: 98%;">
        <ul style=" background-color: rgba(255, 255, 255, 0.94);position: relative;width: 96vw;display: inline-block;left: 2vw;top: 0px;border-radius: 8px;z-index: 9999;">
            <!--                 <li style="border-bottom: 1px solid #e5e5e5;padding: 2.86vw;">
                                <ul style="font-size: 16px;color: #0070c9;font-weight: 100;">
                                    <li style=" list-style-type: none;display: inline-block;">分享 App...</li>
                                    <li style=" list-style-type: none;display: inline-block;float: right;"><img src="share.png" style="width: 30px;float: left;bottom: 8px;position: relative;right: 0px;px;"></li>
                                </ul>
                            </li> -->
            <li style="padding: 2.86vw;">
                <ul style="font-size: 16px;color: #0070c9;font-weight: 100;">更多来自此开发者的App</ul>
                <ul></ul>
            </li>
        </ul>
        <ul style=" background-color: rgba(255, 255, 255, 0.94);position: relative;width: 96vw;display: inline-block;left: 2vw;top: 12px;border-radius: 8px;z-index: 9999;">
            <li style="padding: 2.86vw;">
                <ul style="font-size: 16px;color: #0070c9;font-weight: 600;text-align: center;">取消</ul>
            </li>
        </ul>
    </div>
</div>

<div style="background-color: #eee;padding: 7px;line-height: 1.5em;font-size: 10px;color: darkgray;">
    免责声明：<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;本网站仅为开发者提供App的下载和安装托管，App内的内容和运营相关事项由App开发者负责，与本网站无关
</div>
</body>
</html>